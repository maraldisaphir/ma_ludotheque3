<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ludoth√®que ‚Äì Consultation</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body data-page="consultation">
  <div class="container">
    <div class="header">
      <h1>üé≤ Ludoth√®que ‚Äî Consultation</h1>

<div class="manage-filters">
  <input id="mf-search" class="input" type="text" placeholder="Rechercher un jeu, un type, une description‚Ä¶">
  <select id="mf-type" class="input">
    <option value="">Tous types</option>
  </select>
  <div class="controls-trio">
    <input id="mf-age" class="input" type="number" min="0" placeholder="√Çge min">
    <input id="mf-pmin" class="input" type="number" min="1" placeholder="Joueurs min">
    <input id="mf-pmax" class="input" type="number" min="1" placeholder="Joueurs max">
  </div>
</div>

      <div style="display:flex; gap:8px">
        <a class="button ghost" href="./gestion.html">G√©rer</a>
      </div>
    </div>

    <div class="card">
      <div class="controls">
        <input id="search" class="input" placeholder="Rechercher un jeu, un type, une description‚Ä¶">
        <select id="f-type" class="input" style="max-width:220px"></select>
        <input id="f-age" class="input" type="number" min="0" placeholder="√Çge min">
        <input id="f-min" class="input" type="number" min="1" placeholder="Joueurs min">
        <input id="f-max" class="input" type="number" min="1" placeholder="Joueurs max">
      </div>

      <table class="table">
        <thead>
          <tr>
            <th>Photo</th>
            <th>Jeu</th>
            <th>Joueurs</th>
            <th>√Çge</th>
            <th>Dur√©e</th>
            <th>Type</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <footer>
      Mode sombre (glow n√©on) / clair (pastel). Donn√©es charg√©es automatiquement depuis Netlify Blobs.
    </footer>
  </div>
  <script src="./script.js"></script>

<script>
(function(){
  function $(sel, root){ return (root||document).querySelector(sel); }
  function $all(sel, root){ return Array.from((root||document).querySelectorAll(sel)); }

  const searchInput = $('#mf-search');
  const typeSelect  = $('#mf-type');
  const ageInput    = $('#mf-age');
  const pminInput   = $('#mf-pmin');
  const pmaxInput   = $('#mf-pmax');

  const cards = $all('.game-card').length ? $all('.game-card') : $all('.card');

  const types = new Set();
  cards.forEach(card => {
    $all('.badge, .tag, .pill', card).forEach(b => types.add(b.textContent.trim()));
  });
  const sorted = Array.from(types).sort((a,b)=>a.localeCompare(b,'fr'));
  sorted.forEach(t => {
    const opt = document.createElement('option');
    opt.value = t; opt.textContent = t;
    typeSelect.appendChild(opt);
  });

  function parseNumbers(text){
    const mRange = text.match(/(\d+)\s*[‚Äì-]\s*(\d+)/);
    const mSingle = text.match(/(\d+)\s*joueur/);
    let minP=null, maxP=null;
    if(mRange){ minP = parseInt(mRange[1],10); maxP = parseInt(mRange[2],10); }
    else if(mSingle){ minP = maxP = parseInt(mSingle[1],10); }
    return {minP, maxP};
  }
  function parseAge(text){
    const m = text.match(/(\d+)\s*\+/);
    return m ? parseInt(m[1],10) : null;
  }

  function cardText(card){
    const title = card.querySelector('.game-title, .title, h3, h4, strong')?.textContent || '';
    const desc  = card.querySelector('.game-desc, .desc, p')?.textContent || '';
    const badges= Array.from(card.querySelectorAll('.badge, .tag, .pill')).map(b=>b.textContent).join(' ');
    const meta  = card.textContent || '';
    return {title, desc, badges, meta};
  }

  function matches(card){
    const {title, desc, badges, meta} = cardText(card);
    const hay = (title + ' ' + desc + ' ' + badges).toLowerCase();
    const q = (searchInput.value||'').toLowerCase().trim();
    if(q && !hay.includes(q)) return false;

    const t = typeSelect.value;
    if(t){
      const has = Array.from(card.querySelectorAll('.badge, .tag, .pill')).some(b => b.textContent.trim() === t);
      if(!has) return false;
    }

    const metaLine = card.querySelector('.meta, .game-meta')?.textContent || meta;
    const {minP, maxP} = parseNumbers(metaLine);
    const age = parseAge(metaLine);

    const ageMin = parseInt(ageInput.value,10);
    const pmin   = parseInt(pminInput.value,10);
    const pmax   = parseInt(pmaxInput.value,10);

    if(!isNaN(ageMin) && age !== null && age < ageMin) return false;
    if(!isNaN(pmin) && maxP !== null && maxP < pmin) return false;
    if(!isNaN(pmax) && minP !== null && minP > pmax) return false;

    return true;
  }

  function applyFilters(){
    cards.forEach(card => {
      card.style.display = matches(card) ? '' : 'none';
    });
  }

  [searchInput, typeSelect, ageInput, pminInput, pmaxInput].forEach(el=>{
    if(el) el.addEventListener('input', applyFilters);
    if(el) el.addEventListener('change', applyFilters);
  });

  applyFilters();
})();
</script>

</body>
</html>